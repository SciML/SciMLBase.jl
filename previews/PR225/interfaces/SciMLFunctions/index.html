<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>SciMLFunctions (Jacobians, Sparsity, Etc.) · SciMLBase.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://docs.sciml.ai/SciMLBase/stable/interfaces/SciMLFunctions/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="SciMLBase.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SciMLBase.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Interfaces</span><ul><li><a class="tocitem" href="../Problems/">SciMLProblems</a></li><li class="is-active"><a class="tocitem" href>SciMLFunctions (Jacobians, Sparsity, Etc.)</a><ul class="internal"><li><a class="tocitem" href="#Definition-of-the-AbstractSciMLFunction-Interface"><span>Definition of the AbstractSciMLFunction Interface</span></a></li><li><a class="tocitem" href="#Traits"><span>Traits</span></a></li><li><a class="tocitem" href="#AbstractSciMLFunction-API"><span>AbstractSciMLFunction API</span></a></li></ul></li><li><a class="tocitem" href="../Algorithms/">SciMLAlgorithms</a></li><li><a class="tocitem" href="../Solutions/">SciMLSolutions</a></li><li><a class="tocitem" href="../Init_Solve/">The SciML init and solve Functions</a></li><li><a class="tocitem" href="../Common_Keywords/">Common Keyword Arguments</a></li><li><a class="tocitem" href="../Differentiation/">Automatic Differentiation and Sensitivity Algorithms (Adjoints)</a></li><li><a class="tocitem" href="../PDE/">The PDE Definition Interface</a></li></ul></li><li><span class="tocitem">Fundamentals</span><ul><li><a class="tocitem" href="../../fundamentals/FAQ/">Frequently Asked Questions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Interfaces</a></li><li class="is-active"><a href>SciMLFunctions (Jacobians, Sparsity, Etc.)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>SciMLFunctions (Jacobians, Sparsity, Etc.)</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/SciMLBase.jl/blob/master/docs/src/interfaces/SciMLFunctions.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="scimlfunctions"><a class="docs-heading-anchor" href="#scimlfunctions">SciMLFunctions (Jacobians, Sparsity, Etc.)</a><a id="scimlfunctions-1"></a><a class="docs-heading-anchor-permalink" href="#scimlfunctions" title="Permalink"></a></h1><p>The SciML ecosystem provides an extensive interface for declaring extra functions associated with the differential equation&#39;s data. In traditional libraries there is usually only one option: the Jacobian. However, we allow for a large array of pre-computed functions to speed up the calculations. This is offered via the <code>SciMLFunction</code> types which can be passed to the problems.</p><h2 id="Definition-of-the-AbstractSciMLFunction-Interface"><a class="docs-heading-anchor" href="#Definition-of-the-AbstractSciMLFunction-Interface">Definition of the AbstractSciMLFunction Interface</a><a id="Definition-of-the-AbstractSciMLFunction-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Definition-of-the-AbstractSciMLFunction-Interface" title="Permalink"></a></h2><p>The following standard principles should be adhered to across all <code>AbstractSciMLFunction</code> instantiations.</p><h3 id="Common-Function-Choice-Definitions"><a class="docs-heading-anchor" href="#Common-Function-Choice-Definitions">Common Function Choice Definitions</a><a id="Common-Function-Choice-Definitions-1"></a><a class="docs-heading-anchor-permalink" href="#Common-Function-Choice-Definitions" title="Permalink"></a></h3><p>The full interface available to the solvers is as follows:</p><ul><li><code>jac</code>: The Jacobian of the differential equation with respect to the state variable <code>u</code> at a time <code>t</code> with parameters <code>p</code>.</li><li><code>paramjac</code>: The Jacobian of the differential equation with respect to <code>p</code> at state <code>u</code> at time <code>t</code>.</li><li><code>analytic</code>: Defines an analytical solution using <code>u0</code> at time <code>t</code> with <code>p</code> which will cause the solvers to return errors. Used for testing.</li><li><code>syms</code>: Allows you to name your variables for automatic names in plots and other output.</li><li><code>jac_prototype</code>: Defines the type to be used for any internal Jacobians within the solvers.</li><li><code>sparsity</code>: Defines the sparsity pattern to be used for the sparse differentiation schemes. By default this is equal to <code>jac_prototype</code>. See the sparsity handling portion of this page for more information.</li><li><code>colorvec</code>: The coloring pattern used by the sparse differentiator. See the sparsity handling portion of this page for more information.</li><li><code>observed</code>: A function which allows for generating other observables from a solution.</li></ul><p>Each function type additionally has some specific arguments, refer to their documentation for details.</p><h3 id="In-place-Specification-and-No-Recompile-Mode"><a class="docs-heading-anchor" href="#In-place-Specification-and-No-Recompile-Mode">In-place Specification and No-Recompile Mode</a><a id="In-place-Specification-and-No-Recompile-Mode-1"></a><a class="docs-heading-anchor-permalink" href="#In-place-Specification-and-No-Recompile-Mode" title="Permalink"></a></h3><p>Each SciMLFunction type can be called with an &quot;is inplace&quot; (iip) choice.</p><pre><code class="language-julia hljs">ODEFunction(f)
ODEFunction{iip}(f)</code></pre><p>which is a boolean for whether the function is in the inplace form (mutating to change the first value). This is automatically determined using the methods table but note that for full type-inferrability of the <code>AbstractSciMLProblem</code> this iip-ness should be specified.</p><h3 id="Specialization-Choices"><a class="docs-heading-anchor" href="#Specialization-Choices">Specialization Choices</a><a id="Specialization-Choices-1"></a><a class="docs-heading-anchor-permalink" href="#Specialization-Choices" title="Permalink"></a></h3><p>Each <code>SciMLFunction</code> type allows for specialization choices</p><pre><code class="language-julia hljs">ODEFunction{iip,specialization}(f)</code></pre><p>which designates how the compiler should specialize on the model function <code>f</code>. For more details on specialization choices, see the <a href="../Problems/#scimlproblems">SciMLProblems</a> page.</p><h3 id="Specifying-Jacobian-Types"><a class="docs-heading-anchor" href="#Specifying-Jacobian-Types">Specifying Jacobian Types</a><a id="Specifying-Jacobian-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Specifying-Jacobian-Types" title="Permalink"></a></h3><p>The <code>jac</code> field of an inplace style <code>SciMLFunction</code> has the signature <code>jac(J,u,p,t)</code>, which updates the jacobian <code>J</code> in-place. The intended type for <code>J</code> can sometimes be inferred (e.g. when it is just a dense <code>Matrix</code>), but not in general. To supply the type information, you can provide a <code>jac_prototype</code> in the function&#39;s constructor.</p><p>The following example creates an inplace <code>ODEFunction</code> whose jacobian is a <code>Diagonal</code>:</p><pre><code class="language-julia hljs">using LinearAlgebra
f = (du,u,p,t) -&gt; du .= t .* u
jac = (J,u,p,t) -&gt; (J[1,1] = t; J[2,2] = t; J)
jp = Diagonal(zeros(2))
fun = ODEFunction(f; jac=jac, jac_prototype=jp)</code></pre><p>Note that the integrators will always make a deep copy of <code>fun.jac_prototype</code>, so there&#39;s no worry of aliasing.</p><p>In general the jacobian prototype can be anything that has <code>mul!</code> defined, in particular sparse matrices or custom lazy types that support <code>mul!</code>. A special case is when the <code>jac_prototype</code> is a <code>AbstractDiffEqLinearOperator</code>, in which case you do not need to supply <code>jac</code> as it is automatically set to <code>update_coefficients!</code>. Refer to the <a href="interfaces/@ref">DiffEqOperators</a> section for more information on setting up time/parameter dependent operators.</p><h3 id="Sparsity-Handling"><a class="docs-heading-anchor" href="#Sparsity-Handling">Sparsity Handling</a><a id="Sparsity-Handling-1"></a><a class="docs-heading-anchor-permalink" href="#Sparsity-Handling" title="Permalink"></a></h3><p>The solver libraries internally use packages such as <a href="https://docs.sciml.ai/FiniteDiff/stable/">FiniteDiff.jl</a> and <a href="https://docs.sciml.ai/SparseDiffTools/stable/">SparseDiffTools.jl</a> for high performance calculation of sparse Jacobians and Hessians, along with matrix-free calculations of Jacobian-Vector products (J<em>v), vector-Jacobian products (v&#39;</em>J), and Hessian-vector products (H*v). The SciML interface gives users the ability to control these connections in order to allow for top notch performance.</p><p>The key arguments in the SciMLFunction is the <code>prototype</code>, which is an object that will be used as the underlying Jacobian/Hessian. Thus if one wants to use a sparse Jacobian, one should specify <code>jac_prototype</code> to be a sparse matrix. The sparsity pattern used in the differentiation scheme is defined by <code>sparsity</code>. By default, <code>sparsity=jac_prototype</code>, meaning that the sparse automatic differentiation scheme should specialize on the sparsity pattern given by the actual sparsity pattern. This can be overridden to say perform partial matrix coloring approximations. Additionally, the color vector for the sparse differentiation directions can be specified directly via <code>colorvec</code>. For more information on how these arguments control the differentiation process, see the aforementioned differentiation library documentations.</p><h2 id="Traits"><a class="docs-heading-anchor" href="#Traits">Traits</a><a id="Traits-1"></a><a class="docs-heading-anchor-permalink" href="#Traits" title="Permalink"></a></h2><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>SciMLBase.isinplace(f::SciMLBase.AbstractSciMLFunction)</code>. Check Documenter&#39;s build log for details.</p></div></div><h2 id="AbstractSciMLFunction-API"><a class="docs-heading-anchor" href="#AbstractSciMLFunction-API">AbstractSciMLFunction API</a><a id="AbstractSciMLFunction-API-1"></a><a class="docs-heading-anchor-permalink" href="#AbstractSciMLFunction-API" title="Permalink"></a></h2><h3 id="Abstract-SciML-Functions"><a class="docs-heading-anchor" href="#Abstract-SciML-Functions">Abstract SciML Functions</a><a id="Abstract-SciML-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Abstract-SciML-Functions" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="SciMLBase.AbstractDiffEqFunction" href="#SciMLBase.AbstractDiffEqFunction"><code>SciMLBase.AbstractDiffEqFunction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">abstract type AbstractDiffEqFunction{iip} &lt;: SciMLBase.AbstractSciMLFunction{iip}</code></pre><p>Base for types defining differential equation functions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/SciMLBase.jl/blob/6f9691c33b1789e1efaeed33aeb9b3225c12659b/src/SciMLBase.jl#L526">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SciMLBase.AbstractODEFunction" href="#SciMLBase.AbstractODEFunction"><code>SciMLBase.AbstractODEFunction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">abstract type AbstractODEFunction{iip} &lt;: SciMLBase.AbstractDiffEqFunction{iip}</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/SciMLBase.jl/blob/6f9691c33b1789e1efaeed33aeb9b3225c12659b/src/scimlfunctions.jl#L206">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SciMLBase.AbstractSDEFunction" href="#SciMLBase.AbstractSDEFunction"><code>SciMLBase.AbstractSDEFunction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">abstract type AbstractSDEFunction{iip} &lt;: SciMLBase.AbstractDiffEqFunction{iip}</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/SciMLBase.jl/blob/6f9691c33b1789e1efaeed33aeb9b3225c12659b/src/scimlfunctions.jl#L965">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SciMLBase.AbstractDDEFunction" href="#SciMLBase.AbstractDDEFunction"><code>SciMLBase.AbstractDDEFunction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">abstract type AbstractDDEFunction{iip} &lt;: SciMLBase.AbstractDiffEqFunction{iip}</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/SciMLBase.jl/blob/6f9691c33b1789e1efaeed33aeb9b3225c12659b/src/scimlfunctions.jl#L661">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SciMLBase.AbstractDAEFunction" href="#SciMLBase.AbstractDAEFunction"><code>SciMLBase.AbstractDAEFunction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">abstract type AbstractDAEFunction{iip} &lt;: SciMLBase.AbstractDiffEqFunction{iip}</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/SciMLBase.jl/blob/6f9691c33b1789e1efaeed33aeb9b3225c12659b/src/scimlfunctions.jl#L1446">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SciMLBase.AbstractRODEFunction" href="#SciMLBase.AbstractRODEFunction"><code>SciMLBase.AbstractRODEFunction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">abstract type AbstractRODEFunction{iip} &lt;: SciMLBase.AbstractDiffEqFunction{iip}</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/SciMLBase.jl/blob/6f9691c33b1789e1efaeed33aeb9b3225c12659b/src/scimlfunctions.jl#L1325">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SciMLBase.AbstractDiscreteFunction" href="#SciMLBase.AbstractDiscreteFunction"><code>SciMLBase.AbstractDiscreteFunction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">abstract type AbstractDiscreteFunction{iip} &lt;: SciMLBase.AbstractDiffEqFunction{iip}</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/SciMLBase.jl/blob/6f9691c33b1789e1efaeed33aeb9b3225c12659b/src/scimlfunctions.jl#L895">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SciMLBase.AbstractSDDEFunction" href="#SciMLBase.AbstractSDDEFunction"><code>SciMLBase.AbstractSDDEFunction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">abstract type AbstractSDDEFunction{iip} &lt;: SciMLBase.AbstractDiffEqFunction{iip}</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/SciMLBase.jl/blob/6f9691c33b1789e1efaeed33aeb9b3225c12659b/src/scimlfunctions.jl#L1598">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SciMLBase.AbstractNonlinearFunction" href="#SciMLBase.AbstractNonlinearFunction"><code>SciMLBase.AbstractNonlinearFunction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">abstract type AbstractNonlinearFunction{iip} &lt;: SciMLBase.AbstractSciMLFunction{iip}</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/SciMLBase.jl/blob/6f9691c33b1789e1efaeed33aeb9b3225c12659b/src/scimlfunctions.jl#L1714">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Problems/">« SciMLProblems</a><a class="docs-footer-nextpage" href="../Algorithms/">SciMLAlgorithms »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Monday 28 November 2022 20:43">Monday 28 November 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
