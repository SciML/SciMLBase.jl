<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>SciML Container (Array) and Number Interfaces · SciMLBase.jl</title><meta name="title" content="SciML Container (Array) and Number Interfaces · SciMLBase.jl"/><meta property="og:title" content="SciML Container (Array) and Number Interfaces · SciMLBase.jl"/><meta property="twitter:title" content="SciML Container (Array) and Number Interfaces · SciMLBase.jl"/><meta name="description" content="Documentation for SciMLBase.jl."/><meta property="og:description" content="Documentation for SciMLBase.jl."/><meta property="twitter:description" content="Documentation for SciMLBase.jl."/><meta property="og:url" content="https://docs.sciml.ai/SciMLBase/stable/interfaces/Array_and_Number/"/><meta property="twitter:url" content="https://docs.sciml.ai/SciMLBase/stable/interfaces/Array_and_Number/"/><link rel="canonical" href="https://docs.sciml.ai/SciMLBase/stable/interfaces/Array_and_Number/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="SciMLBase.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SciMLBase.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Interfaces</span><ul><li class="is-active"><a class="tocitem" href>SciML Container (Array) and Number Interfaces</a><ul class="internal"><li><a class="tocitem" href="#Note-About-Wrapped-Solvers"><span>Note About Wrapped Solvers</span></a></li><li><a class="tocitem" href="#SciML-Number-Types"><span>SciML Number Types</span></a></li><li><a class="tocitem" href="#SciML-Container-(Array)-Types"><span>SciML Container (Array) Types</span></a></li></ul></li><li><a class="tocitem" href="../Problems/">SciMLProblems</a></li><li><a class="tocitem" href="../SciMLFunctions/">SciMLFunctions (Jacobians, Sparsity, Etc.)</a></li><li><a class="tocitem" href="../Algorithms/">SciMLAlgorithms</a></li><li><a class="tocitem" href="../Solutions/">SciMLSolutions</a></li><li><a class="tocitem" href="../Init_Solve/">The SciML init and solve Functions</a></li><li><a class="tocitem" href="../Common_Keywords/">Common Keyword Arguments</a></li><li><a class="tocitem" href="../Differentiation/">Automatic Differentiation and Sensitivity Algorithms (Adjoints)</a></li><li><a class="tocitem" href="../PDE/">The PDE Definition Interface</a></li></ul></li><li><span class="tocitem">Fundamentals</span><ul><li><a class="tocitem" href="../../fundamentals/FAQ/">Frequently Asked Questions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Interfaces</a></li><li class="is-active"><a href>SciML Container (Array) and Number Interfaces</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>SciML Container (Array) and Number Interfaces</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/SciMLBase.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/SciMLBase.jl/blob/master/docs/src/interfaces/Array_and_Number.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="arrayandnumber"><a class="docs-heading-anchor" href="#arrayandnumber">SciML Container (Array) and Number Interfaces</a><a id="arrayandnumber-1"></a><a class="docs-heading-anchor-permalink" href="#arrayandnumber" title="Permalink"></a></h1><p>We live in a society, and therefore there are rules. In this tutorial we outline the rules which are required on container and number types which are allowable in SciML tools.</p><div class="admonition is-category-warn"><header class="admonition-header">Warn</header><div class="admonition-body"><p>In general as of 2023, strict adherence to this interface is an early work-in-progress. If anything does not conform to the documented interface, please open an issue.</p></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>There are many types which can work with a specific solver that do satisfy this interface. Many times as part of prototyping you may want to side-step the high level interface checks in order to simply test whether a new type is working. To do this, set <code>interface_checks = false</code> as a keyword argument to <code>init</code>/<code>solve</code> to bypass any of the internal interface checks. This means you will no longer get a nice high-level error message and instead it will attempt to use the type without restrictions. Note that not every problem/solver has implemented this new keyword argument as of 2023.</p></div></div><h2 id="Note-About-Wrapped-Solvers"><a class="docs-heading-anchor" href="#Note-About-Wrapped-Solvers">Note About Wrapped Solvers</a><a id="Note-About-Wrapped-Solvers-1"></a><a class="docs-heading-anchor-permalink" href="#Note-About-Wrapped-Solvers" title="Permalink"></a></h2><p>Due to limitations of wrapped solvers, any solver that is a wrapped solver from an existing C/Fortran code is inherently limited to <code>Float64</code> and <code>Vector{Float64}</code> for its operations. This includes packages like Sundials.jl, LSODA.jl, DASKR.jl, MINPACK.jl, and many more. This is fundamental to these solvers and it is not expected that they will allow the full set of SciML types in the future. If more abstract number/container definitions are required, then these are not the appropriate solvers to use.</p><h2 id="SciML-Number-Types"><a class="docs-heading-anchor" href="#SciML-Number-Types">SciML Number Types</a><a id="SciML-Number-Types-1"></a><a class="docs-heading-anchor-permalink" href="#SciML-Number-Types" title="Permalink"></a></h2><p>The number types are the types used to define the dependent variables (i.e. <code>u0</code>) and the independent variables (<code>t</code> or <code>tspan</code>). These two types can be different, and can have different restrictions depending on the type of solver which is employed. The following rules for a Number type are held in general:</p><ul><li>Number types can be used in SciML directly or in containers. If a problem defines a value like <code>u0</code> using a Number type, the out-of-place form must be used for the problem definition.</li><li><code>x::T + y::T = z::T</code></li><li><code>x::T * y::T = z::T</code></li><li><code>oneunit(x::T)::T</code></li><li><code>one(x::T) * oneunit(x::T) = z::T</code></li><li><code>t::T2 * x::T + y::T = z::T</code> for <code>T2</code> a time type and <code>T</code> the dependent variable type (this includes the <code>muladd</code> equivalent form).</li></ul><p>Additionally, the following rules apply to subsets of uses:</p><h3 id="Adaptive-Number-Types"><a class="docs-heading-anchor" href="#Adaptive-Number-Types">Adaptive Number Types</a><a id="Adaptive-Number-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Adaptive-Number-Types" title="Permalink"></a></h3><ul><li><code>x::T / y::T = z::T</code></li><li>Default choices of norms can assume <code>sqrt(x::T)::T</code> exists. If <code>internalnorm</code> is overridden then this may not be required (for example, changing the norm to inf-norm).</li><li><code>x::T ^ y::T = z::T</code></li></ul><h3 id="Time-Types-(Independent-Variables)"><a class="docs-heading-anchor" href="#Time-Types-(Independent-Variables)">Time Types (Independent Variables)</a><a id="Time-Types-(Independent-Variables)-1"></a><a class="docs-heading-anchor-permalink" href="#Time-Types-(Independent-Variables)" title="Permalink"></a></h3><ul><li>If a solver is time adaptive, the time type must be a floating point number. <code>Rational</code> is only allowed for non-adaptive solves.</li></ul><h2 id="SciML-Container-(Array)-Types"><a class="docs-heading-anchor" href="#SciML-Container-(Array)-Types">SciML Container (Array) Types</a><a id="SciML-Container-(Array)-Types-1"></a><a class="docs-heading-anchor-permalink" href="#SciML-Container-(Array)-Types" title="Permalink"></a></h2><p>Container types are types which hold number types. They can be used to define objects like the state vector  (<code>u0</code>) of a problem. The following operations are required in a container type to be used with SciML solvers:</p><ul><li>Broadcast is defined <a href="https://docs.julialang.org/en/v1/manual/interfaces/#man-interfaces-broadcasting">according to the Julia broadcast interface</a>.</li><li>The container type correctly defines <a href="https://docs.sciml.ai/ArrayInterface/stable/">interface overloads to satisfy the ArrayInterface.jl specification</a>.</li><li><code>ArrayInterface.zeromatrix(x::T)::T2</code> defines a compatible matrix type (see below)</li><li><code>eltype(x::T)::T2</code> is a compatible Number type.</li><li><code>x::T .+ y::T = z::T</code> (i.e. broadcast similar is defined to be type-presurving)</li><li>Indexing is only required if <code>ArrayInterface.fast_scalar_indexing(x::T)==true</code>. If true, scalar indexing <code>x[i]</code> is assumed to be defined and run through all variables.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>&quot;<code>eltype(x::T)::T2</code> is a compatible Number type&quot; excludes <code>Array{Array{T}}</code> types of types. However, recursive vectors can conformed to the interface with zero overhead using tools from RecursiveArrayTools.jl such as <code>VectorOfArray(x)</code>. Since this greatly simplifies the interfaces and the ability to check for correctness, doing this wrapping is highly recommended and there are no plans to relax this requirement.</p></div></div><p>Additionally, the following rules apply to subsets of uses:</p><h3 id="SciML-Mutable-Array-Types"><a class="docs-heading-anchor" href="#SciML-Mutable-Array-Types">SciML Mutable Array Types</a><a id="SciML-Mutable-Array-Types-1"></a><a class="docs-heading-anchor-permalink" href="#SciML-Mutable-Array-Types" title="Permalink"></a></h3><ul><li><code>similar(x::T)::T</code></li><li><code>zero(x::T)::T</code></li><li><code>z::T .= x::T .+ y::T</code> is defined</li><li><code>z::T .= x::T .* y::T</code> is defined</li><li><code>z::T .= t::T2 .* x::T</code> where <code>T2</code> is the time type (a Number) and <code>T</code> is the container type.</li><li>(Optional) <code>Base.resize!(x,i)</code> is required for <code>resize!(integrator,i)</code> to be supported.</li></ul><h3 id="SciML-Matrix-(Operator)-Type"><a class="docs-heading-anchor" href="#SciML-Matrix-(Operator)-Type">SciML Matrix (Operator) Type</a><a id="SciML-Matrix-(Operator)-Type-1"></a><a class="docs-heading-anchor-permalink" href="#SciML-Matrix-(Operator)-Type" title="Permalink"></a></h3><p>Note that the matrix type may not match the type of the initial container <code>u0</code>. An example is <code>ComponentMatrix</code> as the matrix structure corresponding to a <code>ComponentArray</code>. However, the following actions are assumed to hold on the resulting matrix type:</p><ul><li><code>solve(LinearProblem(A::T,b::T2),linsolve)</code> must be defined for a solver to work on a given SciML matrix type <code>T2</code>.</li><li>If the matrix is an operator, i.e. a lazy construct, it should conform to the  <a href="https://docs.sciml.ai/SciMLOperators/stable/">SciMLOperators</a> interface.</li><li>If not a SciMLOperator, <code>diagind(W::T)</code> should be defined and <code>@view(A[idxs])=@view(A[idxs]) + λ::T</code></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../Problems/">SciMLProblems »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Monday 1 January 2024 11:45">Monday 1 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
